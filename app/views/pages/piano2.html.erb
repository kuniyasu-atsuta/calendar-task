<% provide(:title, "piano") %>
<% provide(:css, (stylesheet_link_tag 'bootstrap.min',
                                      'piano',
                                      'keys',
                                      'icons',
                                      'style')) %>
<% provide(:js1, (javascript_include_tag 'vend/jquery-1.7.2.min',
                                         'vend/jquery-ui-1.8.20.custom.min')) %>

<% keys = ['C3', 'Db3', 'D3', 'Eb3', 'E3', 'F3', 'Gb3', 'G3', 'Ab3', 'A3',
         'Bb3', 'B3', 'C4', 'Db4', 'D4', 'Eb4', 'E4', 'F4', 'Gb4', 'G4',
         'Ab4', 'A4', 'Bb4', 'B4', 'C5', 'Db5', 'D5', 'Eb5', 'E5', 'F5',
         'Gb5', 'G5', 'Ab5', 'A5', 'Bb5', 'B5', 'C6'] %>

   <% for i in keys do %>
     <%= audio_tag("samples/#{i}.mp3", id: "sound-#{i}", preload: "auto") %>
   <% end %>

<div id="wrapper">

  <%= render 'layouts/top_bar', locals: {title: "piano"} %>
  <%= render 'layouts/left_sidebar' %>
    <div class="content-page">
        <!-- Start content -->
      <div class="content">
        <div class="container-fluid">

          <div class="piano">
            <noscript class="piano-javascript">This program requires Javascript and HTML5 Audio support.</noscript>
            <div class="piano-container">
              <div class="piano-keys">
                <div class="piano-white piano-C4"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Db4"></div></div>
                <div class="piano-white piano-D4">D4</div>
                <div class="piano-black"><div class="piano-black-raised piano-Eb4"></div></div>
                <div class="piano-white piano-E4"></div>
                <div class="piano-white piano-F4"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Gb4"></div></div>
                <div class="piano-white piano-G4"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Ab4"></div></div>
                <div class="piano-white piano-A4"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Bb4"></div></div>
                <div class="piano-white piano-B4"></div>
                <div class="piano-white piano-C5"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Db5"></div></div>
                <div class="piano-white piano-D5"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Eb5"></div></div>
                <div class="piano-white piano-E5"></div>
                <div class="piano-white piano-F5"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Gb5"></div></div>
                <div class="piano-white piano-G5"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Ab5"></div></div>
                <div class="piano-white piano-A5"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Bb5"></div></div>
                <div class="piano-white piano-B5"></div>
                <div class="piano-white piano-C6"></div>
              </div>
              <div class="piano-keys">
                <div class="piano-white piano-C3"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Db3"></div></div>
                <div class="piano-white piano-D3"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Eb3"></div></div>
                <div class="piano-white piano-E3"></div>
                <div class="piano-white piano-F3"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Gb3"></div></div>
                <div class="piano-white piano-G3"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Ab3"></div></div>
                <div class="piano-white piano-A3"></div>
                <div class="piano-black"><div class="piano-black-raised piano-Bb3"></div></div>
                <div class="piano-white piano-B3"></div>
                <div class="piano-white piano-C4"></div>
              </div>
              <div class="piano-pedal">Just listen to that sustain!</div>
            </div>
          </div>

          <style>
            body {
              padding: 20px;
              color: #666;
              font-family: Helvetica Neue,Helvetica,Arial,sans-serif;
            }
            h2 {
              font-weight: normal;
              font-size: 18px;
            }
            .section > div {
              display: inline-block;
              margin: 2px;
            }
          </style>

        <div class="piano-container">
          <div class="section">
            <div>
              <icon class="keyboard-key `"></icon>
            </div>
            <div>
              <icon class="keyboard-key one"></icon>
            </div>
            <div>
              <icon class="keyboard-key two"></icon>
            </div>
            <div>
              <icon class="keyboard-key three"></icon>
            </div>
            <div>
              <icon class="keyboard-key four"></icon>
            </div>
            <div>
              <icon class="keyboard-key five"></icon>
            </div>
            <div>
              <icon class="keyboard-key six"></icon>
            </div>
            <div>
              <icon class="keyboard-key seven"></icon>
            </div>
            <div>
              <icon class="keyboard-key eight"></icon>
            </div>
            <div>
              <icon class="keyboard-key nine"></icon>
            </div>
            <div>
              <icon class="keyboard-key zero"></icon>
            </div>
            <div>
              <icon class="keyboard-key zero"></icon>
            </div>
            <div>
              <icon class="keyboard-key zero"></icon>
            </div>
            <div>
              <icon class="keyboard-key delete"></icon>
            </div>
          </div>
          <div class="section">
            <div>
              <icon class="keyboard-key tab"></icon>
            </div>
            <div>
              <icon class="keyboard-key q"></icon>
            </div>
            <div>
              <icon class="keyboard-key w"></icon>
            </div>
            <div>
              <icon class="keyboard-key e"></icon>
            </div>
            <div>
              <icon class="keyboard-key r"></icon>
            </div>
            <div>
              <icon class="keyboard-key t"></icon>
            </div>
            <div>
              <icon class="keyboard-key y"></icon>
            </div>
            <div>
              <icon class="keyboard-key u"></icon>
            </div>
            <div>
              <icon class="keyboard-key i"></icon>
            </div>
            <div>
              <icon class="keyboard-key o"></icon>
            </div>
            <div>
              <icon class="keyboard-key p"></icon>
            </div>
            <div>
              <icon class="keyboard-key ["></icon>
            </div>
            <div>
              <icon class="keyboard-key ]"></icon>
            </div>
            <div>
              <icon class="keyboard-key Â¥"></icon>
            </div>
          </div>
          <div class="section">
            <div>
              <icon class="keyboard-key caps"></icon>
            </div>
            <div>
              <icon class="keyboard-key a"></icon>
            </div>
            <div>
              <icon class="keyboard-key s"></icon>
            </div>
            <div>
              <icon class="keyboard-key d"></icon>
            </div>
            <div>
              <icon class="keyboard-key f"></icon>
            </div>
            <div>
              <icon class="keyboard-key g"></icon>
            </div>
            <div>
              <icon class="keyboard-key h"></icon>
            </div>
            <div>
              <icon class="keyboard-key j"></icon>
            </div>
            <div>
              <icon class="keyboard-key k"></icon>
            </div>
            <div>
              <icon class="keyboard-key l"></icon>
            </div>
            <div>
              <icon class="keyboard-key ;"></icon>
            </div>
            <div>
              <icon class="keyboard-key '"></icon>
            </div>
            <div>
              <icon class="keyboard-key return"></icon>
            </div>
          </div>
          <div class="section">
            <div>
              <icon class="keyboard-key shift"></icon>
            </div>
            <div>
              <icon class="keyboard-key z"></icon>
            </div>
            <div>
              <icon class="keyboard-key x"></icon>
            </div>
            <div>
              <icon class="keyboard-key c"></icon>
            </div>
            <div>
              <icon class="keyboard-key v"></icon>
            </div>
            <div>
              <icon class="keyboard-key b"></icon>
            </div>
            <div>
              <icon class="keyboard-key n"></icon>
            </div>
            <div>
              <icon class="keyboard-key m"></icon>
            </div>
            <div>
              <icon class="keyboard-key ,"></icon>
            </div>
            <div>
              <icon class="keyboard-key ."></icon>
            </div>
            <div>
              <icon class="keyboard-key /"></icon>
            </div>
            <div>
              <icon class="keyboard-key shift"></icon>
            </div>
          </div>
          <div class="section">
            <div class="mx-auto">
              <icon class="keyboard-key space mx-auto"></icon>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  var icons = document.querySelectorAll('icon')
  var button = document.querySelectorAll('button')[0]

  button.addEventListener('click', switchTheme)

  function switchTheme() {
    var l = icons.length
    while (l--) icons[l].classList.toggle('dark')
  }

  window.addEventListener('keydown', classy('add', 'keyboard-keydown'))
  window.addEventListener('keyup', classy('remove', 'keyboard-keydown'))

  function classy (method, className) {
    return function (e) {
      var els = getKeyEl(e)
      while (els.length) els.pop().classList[method](className)
    }
  }

  var keyMap = {
    8: 'delete',
    9: 'tab',
    13: 'return',
    16: 'shift',
    17: 'ctrl',
    18: 'alt, .keyboard-key.option',
    27: 'esc',
    32: 'space',
    91: 'cmd',
    37: 'left',
    38: 'up',
    39: 'right',
    40: 'down'
  }

  function getKeyEl (e) {
    var char = String.fromCharCode(e.which)
    if (e.which >= 112 && e.which < 112 + 12) {
      char = 'f' + (e.which - 111)
    } else if (keyMap[e.which]) {
      char = keyMap[e.which]
    } else if (/\d/.test(char)) {
      char = ['zero','one','two','three','four', 'five','six','seven','eight','nine'][Number(char)]
    }
    if (char) {
      var charEl = document.querySelectorAll('.keyboard-key.' + char.toLowerCase())
      if (charEl.length) return [].slice.call(charEl)
    }
  }
</script>

<% provide(:js2, (javascript_include_tag 'piano.js')) %>
